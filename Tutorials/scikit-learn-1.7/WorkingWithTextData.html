<!doctype html>
<html style='font-size:20px !important'>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'><style type='text/css'>html {overflow-x: initial !important;}</style>
<style type='text/css'  id="style-base">:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, "Segoe UI Emoji", "SF Pro", sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p *, #write.first-line-indent svg * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; position: relative; }
#write svg h1, #write svg h2, #write svg h3, #write svg h4, #write svg h5, #write svg h6, #write svg p { position: static; white-space: nowrap; overflow: visible; }
foreignObject { overflow: visible; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
li p { orphans: 1; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror-linenumber { -webkit-user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit; background-repeat: inherit; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; background-position: 0px 0px; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background-color: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { white-space: pre !important; border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; text-shadow: initial !important; background-position: 0px 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background-color: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.mermaid-svg { margin: auto; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571429rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left-width: 0.25em; border-left-style: solid; border-left-color: rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }

</style>
<style type='text/css'  id="style-codemirror">.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; white-space: nowrap; background-position: inherit; background-repeat: inherit; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; border: none !important; background-position: 0px 0px !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: 0px 0px; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}

</style>
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&amp;subset=latin,latin-ext' type='text/css' />
<style type='text/css'  id="style-theme_css">:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', 'SF Pro', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    pre {
        page-break-inside: avoid;
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.mac-os #write{
    caret-color: AccentColor;
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}
</style>
<style type='text/css'  id="style-lp">ol, ul {padding-left: 40px}</style>
<style type='text/css'  id="style-mac-print"> @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}</style>
<style type='text/css'  id="style-preLinebreakOnExport"> .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} h1,h2,h3,h4,h5 {white-space:pre-line}</style>
<meta name="title" content="">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="material" content="">
<meta name="author" content="">
<meta name="generator" content="">
<title>WorkingWithTextData</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><p><a href='ScikitLearnTutorials.md'><span>scikit-learn tutorials index</span></a></p><h1>Working With Text Data</h1><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n306"><a class="md-toc-inner" style="" href="#tutorial-setup">Tutorial setup</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n309"><a class="md-toc-inner" style="" href="#loading-the-20-newsgroups-dataset">Loading the 20 newsgroups dataset</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n318"><a class="md-toc-inner" style="" href="#exploring-the-data">Exploring the Data</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n345"><a class="md-toc-inner" style="" href="#building-feature-vectors-and-training">Building Feature Vectors and Training</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n346"><a class="md-toc-inner" style="" href="#extracting-features-from-text-files">Extracting features from text files</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n348"><a class="md-toc-inner" style="" href="#bags-of-words">Bags of words</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n360"><a class="md-toc-inner" style="" href="#tokenize-the-text-and-build-feature-vectors">Tokenize the Text and Build Feature Vectors</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n369"><a class="md-toc-inner" style="" href="#code-explanation">Code Explanation</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n382"><a class="md-toc-inner" style="" href="#explore-the-feature-vector-matrix">Explore the Feature Vector Matrix</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n398"><a class="md-toc-inner" style="" href="#transform-occurance-counts-to-frequencies">Transform Occurance Counts to Frequencies</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n401"><a class="md-toc-inner" style="" href="#calculating-term-frequency">Calculating Term Frequency</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n407"><a class="md-toc-inner" style="" href="#calculating-term-frequency-and-inverse-term-frequency">Calculating Term Frequency and Inverse Term Frequency</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n414"><a class="md-toc-inner" style="" href="#training-a-classifier">Training a classifier</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n417"><a class="md-toc-inner" style="" href="#making-predictions">Making Predictions</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n440"><a class="md-toc-inner" style="" href="#building-a-pipeline">Building a Pipeline</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n457"><a class="md-toc-inner" style="" href="#testing-classification-accuracy">Testing Classification Accuracy</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n463"><a class="md-toc-inner" style="" href="#train-and-test-a-support-vector-machine">Train and Test a Support Vector Machine</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n472"><a class="md-toc-inner" style="" href="#classification-report">Classification Report</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n650"><a class="md-toc-inner" style="" href="#confusion-matrix">Confusion Matrix</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n535"><a class="md-toc-inner" style="" href="#parameter-tuning-using-grid-search">Parameter Tuning Using Grid Search</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n557"><a class="md-toc-inner" style="" href="#exercises">Exercises</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n558"><a class="md-toc-inner" style="" href="#setup-for-all-the-exercises">Setup for All the Exercises</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n580"><a class="md-toc-inner" style="" href="#exercise-1-language-identification">Exercise 1: Language identification</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n588"><a class="md-toc-inner" style="" href="#hints">Hints</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n594"><a class="md-toc-inner" style="" href="#exercise-2-sentiment-analysis-on-movie-reviews">Exercise 2: Sentiment Analysis on movie reviews</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n604"><a class="md-toc-inner" style="" href="#exercise-3-cli-text-classification-utility">Exercise 3: CLI text classification utility</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n607"><a class="md-toc-inner" style="" href="#where-to-from-here">Where to from here</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n622"><a class="md-toc-inner" style="" href="#whats-new-in-scikit-learn-17-for-text-processing">What's New in scikit-learn 1.7 for Text Processing</a></span></p></div><p><span>The goal of this guide is to explore some of the main </span><code>scikit-learn</code><span> tools on a single practical task: analyzing a collection of text documents (newsgroups posts) on twenty different topics.</span></p><p><span>In this section we will see how to:</span></p><ul><li><p><span>Load the file contents and the categories.</span></p></li><li><p><span>Extract feature vectors suitable for machine learning.</span></p></li><li><p><span>Train a linear model to perform categorization.</span></p></li><li><p><span>Use a grid search strategy to find a good configuration of both the feature extraction components and the classifier.</span></p></li></ul><h2 id='tutorial-setup'><span>Tutorial setup</span></h2><p><span>To get started with this tutorial, you must first install </span><em><span>scikit-learn</span></em><span> and all of its required dependencies.</span></p><p><span>Please refer to the </span><a href='https://scikit-learn.org/1.7/install.html#installation-instructions'><span>installation instructions</span></a><span> page for more information and for system-specific instructions.</span></p><h3 id='loading-the-20-newsgroups-dataset'><span>Loading the 20 newsgroups dataset</span></h3><p><span>The dataset is called “Twenty Newsgroups”. Here is the official description, quoted from the </span><a href='http://qwone.com/~jason/20Newsgroups/'><span>website</span></a><span>:</span></p><blockquote><p><span>The 20 Newsgroups data set is a collection of approximately 20,000 newsgroup documents, partitioned (nearly) evenly across 20 different newsgroups. To the best of our knowledge, it was originally collected by Ken Lang, probably for his paper &quot;</span><a href='http://qwone.com/~jason/20Newsgroups/lang95.bib'><span>Newsweeder: Learning to filter netnews</span></a><span>&quot;, though he does not explicitly mention this collection. The 20 newsgroups collection has become a popular data set for experiments in text applications of machine learning techniques, such as text classification and text clustering.</span></p></blockquote><p><span>In the following we will use the built-in dataset loader for 20 newsgroups from scikit-learn. Alternatively, it is possible to download the dataset manually from the website and use the </span><a href='https://scikit-learn.org/1.7/modules/generated/sklearn.datasets.load_files.html#sklearn.datasets.load_files'><code>sklearn.datasets.load_files</code></a><span> function by pointing it to the </span><code>20news-bydate-train</code><span> sub-folder of the uncompressed archive folder.</span></p><p><span>In order to get faster execution times for this first example, we will work on a partial dataset with only 4 categories out of the 20 available in the dataset:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">categories</span> <span class="cm-operator">=</span> [<span class="cm-string">'alt.atheism'</span>, <span class="cm-string">'soc.religion.christian'</span>,<span class="cm-string">'comp.graphics'</span>, <span class="cm-string">'sci.med'</span>]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><p><span>We can now load the list of files matching those categories as follows:</span>
<em><strong><span>(This will take a minute or more to load.)</span></strong></em></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">fetch_20newsgroups</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">twenty_train</span> <span class="cm-operator">=</span> <span class="cm-variable">fetch_20newsgroups</span>(<span class="cm-variable">subset</span><span class="cm-operator">=</span><span class="cm-string">'train'</span>, <span class="cm-variable">categories</span><span class="cm-operator">=</span><span class="cm-variable">categories</span>, <span class="cm-variable">shuffle</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>, <span class="cm-variable">random_state</span><span class="cm-operator">=</span><span class="cm-number">42</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 83px;"></div><div class="CodeMirror-gutters" style="display: none; height: 83px;"></div></div></div></pre><h4 id='exploring-the-data'><span>Exploring the Data</span></h4><p><span>Now that the 4 newsgroups are loaded into </span><code>twenty_train</code><span>, (note that it&#39;s just the four specified in </span><code>categories</code><span> not twenty) lets explore the dataset. (This isn&#39;t part of the training process</span>&mdash;<span> it&#39;s just to help you understand the dataset.)</span></p><p><span>The returned dataset is a </span><code>scikit-learn</code><span> “bunch”: a simple holder object with fields that can be both accessed as python </span><code>dict</code><span> keys or </span><code>object</code><span> attributes for convenience, for instance the </span><code>target_names</code><span> holds the list of the requested category names:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">twenty_train</span>.<span class="cm-property">target_names</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><blockquote><p><em><span>response:</span></em><span></span><br/><span>[&#39;alt.atheism&#39;, &#39;comp.graphics&#39;, &#39;sci.med&#39;, &#39;soc.religion.christian&#39;]</span></p></blockquote><p><span>The files themselves are loaded in memory in the </span><code>data</code><span> attribute. For reference the filenames are also available:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">len</span>(<span class="cm-variable">twenty_train</span>.<span class="cm-property">data</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">len</span>(<span class="cm-variable">twenty_train</span>.<span class="cm-property">filenames</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 56px;"></div><div class="CodeMirror-gutters" style="display: none; height: 56px;"></div></div></div></pre><blockquote><p><em><span>response:</span></em><span></span><br/><span>2257</span>
<span>2257</span></p></blockquote><p><span>Let’s print the first lines of the first loaded file:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"\n"</span>.<span class="cm-property">join</span>(<span class="cm-variable">twenty_train</span>.<span class="cm-property">data</span>[<span class="cm-number">0</span>].<span class="cm-property">split</span>(<span class="cm-string">"\n"</span>)[:<span class="cm-number">3</span>]))</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><blockquote><p><em><span>response:</span></em><span></span><br/><span>From: sd345@city.ac.uk (Michael Collier)</span>
<span>Subject: Converting images to HP LaserJet III?</span>
<span>Nntp-Posting-Host: hampton</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">twenty_train</span>.<span class="cm-property">target_names</span>[<span class="cm-variable">twenty_train</span>.<span class="cm-property">target</span>[<span class="cm-number">0</span>]])</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><blockquote><p><em><span>response:</span></em>
<span>comp.graphics</span></p></blockquote><p><span>Supervised learning algorithms will require a category label for each document in the training set. In this case the category is the name of the newsgroup which also happens to be the name of the folder holding the individual documents.</span></p><p><span>For speed and space efficiency reasons, </span><code>scikit-learn</code><span> loads the target attribute as an array of integers that correspond to the index of the category name in the </span><code>target_names</code><span> list. The category integer id of each sample is stored in the </span><code>target</code><span> attribute:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">twenty_train</span>.<span class="cm-property">target</span>[:<span class="cm-number">10</span>]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><blockquote><p><em><span>response:</span></em><span></span><br/><span>array([1, 1, 3, 3, 3, 3, 3, 2, 2, 2])</span></p></blockquote><p><span>It is possible to get back the category names as follows:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">t</span> <span class="cm-keyword">in</span> <span class="cm-variable">twenty_train</span>.<span class="cm-property">target</span>[:<span class="cm-number">10</span>]:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin">print</span>(<span class="cm-variable">twenty_train</span>.<span class="cm-property">target_names</span>[<span class="cm-variable">t</span>])</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 56px;"></div><div class="CodeMirror-gutters" style="display: none; height: 56px;"></div></div></div></pre><blockquote><p><em><span>response:</span></em><span></span><br/><span>comp.graphics</span>
<span>comp.graphics</span>
<span>soc.religion.christian</span>
<span>soc.religion.christian</span>
<span>soc.religion.christian</span>
<span>soc.religion.christian</span>
<span>soc.religion.christian</span>
<span>sci.med</span>
<span>sci.med</span>
<span>sci.med</span></p></blockquote><p><span>You might have noticed that the samples were shuffled randomly when we called </span><code>fetch_20newsgroups(..., shuffle=True, random_state=42)</code><span>: this is useful if you wish to select only a subset of samples to quickly train a model and get a first idea of the results before re-training on the complete dataset later.</span></p><h2 id='building-feature-vectors-and-training'><span>Building Feature Vectors and Training</span></h2><h3 id='extracting-features-from-text-files'><span>Extracting features from text files</span></h3><p><span>In order to perform machine learning on text documents, we first need to turn the text content into </span><em><span>numerical</span></em><span> </span><em><span>feature vectors</span></em><span>.</span></p><h4 id='bags-of-words'><span>Bags of words</span></h4><p><span>The most intuitive way to do so is to use a &quot;bags of words&quot; representation:</span></p><ol start='' ><li><p><span>Assign a fixed integer id to each word occurring in any document of the training set (for instance, by building a dictionary from words to integer indices).</span></p></li><li><p><span>For each document </span><code>#i</code><span>, count the number of occurrences of each word </span><code>w</code><span> and store it in </span><code>X[i, j]</code><span> as the value of feature </span><code>#j</code><span> where </span><code>j</code><span> is the index of word </span><code>w</code><span> in the dictionary.</span></p></li></ol><p><span>The bags of words representation implies that </span><code>n_features</code><span> is the number of distinct words in the corpus: this number is typically larger than 100,000.</span></p><p><span>If </span><code>n_samples == 10000</code><span>, storing </span><code>X</code><span> as a NumPy array of type float32 would require 10000 x 100000 x 4 bytes = 4GB in RAM which is a lot for the average consumer computer.</span></p><p><span>Fortunately, </span><u><span>most values in x will be zeros</span></u><span> since for a given document less than a few thousand distinct words will be used. For this reason we say that bags of words are typically </span><em><span>high-dimensional sparse</span></em><span> datasets. We can save a lot of memory by only storing the non-zero parts of the feature vectors in memory.</span></p><p><code>scipy.sparse</code><span> matrices are data structures that do exactly this, and </span><code>scikit-learn</code><span> has built-in support for these structures. </span></p><p><strong><span>Note:</span></strong><span> In scikit-learn 1.7, all text processing estimators now also accept the new sparse arrays (</span><code>sparray</code><span>) in addition to traditional sparse matrices, ensuring compatibility with future versions of SciPy as it transitions from sparse matrices to sparse arrays.</span></p><h4 id='tokenize-the-text-and-build-feature-vectors'><span>Tokenize the Text and Build Feature Vectors</span></h4><p><span>Text preprocessing</span><sup class='md-footnote'><a href='#dfref-footnote-1' name='ref-footnote-1'>1</a></sup><span>, tokenizing</span><sup class='md-footnote'><a href='#dfref-footnote-2' name='ref-footnote-2'>2</a></sup><span> and filtering (removal) of stopwords</span><sup class='md-footnote'><a href='#dfref-footnote-3' name='ref-footnote-3'>3</a></sup><span> are all included in </span><a href='https://scikit-learn.org/1.7/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html#sklearn.feature_extraction.text.CountVectorizer'><code>CountVectorizer</code></a><span>, which:</span></p><ul><li><p><span>Builds a dictionary of features in which each unique token (word) found across all documents is assigned a specific index (a column number in the resulting matrix).</span></p></li><li><p><span>Transforms documents to feature vectors</span><sup class='md-footnote'><a href='#dfref-footnote-4' name='ref-footnote-4'>4</a></sup><span>. Each document is transformed into a vector (a row in the matrix) where the value at each position corresponds to the count (</span><em><span>frequency</span></em><span>) of a specific word (</span><em><span>feature</span></em><span>) from the dictionary in that document.</span></p></li></ul><p><span>This code does all that:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">feature_extraction</span>.<span class="cm-property">text</span> <span class="cm-keyword">import</span> <span class="cm-variable">CountVectorizer</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">count_vect</span> <span class="cm-operator">=</span> <span class="cm-variable">CountVectorizer</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_counts</span> <span class="cm-operator">=</span> <span class="cm-variable">count_vect</span>.<span class="cm-property">fit_transform</span>(<span class="cm-variable">twenty_train</span>.<span class="cm-property">data</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 83px;"></div><div class="CodeMirror-gutters" style="display: none; height: 83px;"></div></div></div></pre><h5 id='code-explanation'><span>Code Explanation</span></h5><ul><li><p><code>from sklearn.feature_extraction.text import CountVectorizer</code>
<span>Imports the </span><code>CountVectorizer</code><span> class from the scikit-learn library. </span><code>CountVectorizer</code><span> is a feature extractor.</span></p></li><li><p><code>count_vect = CountVectorizer()</code>
<span>Creates an instance of the </span><code>CountVectorizer</code><span>. This object now holds the logic for the entire text-to-numerical conversion process and has stored the vocabulary of the </span><code>twenty_train</code><span> dataset.</span></p></li><li><p><code>X_train_counts = count_vect.fit_transform(twenty_train.data)</code>
<span>This is the main operation, which performs two main steps: </span><code>fit</code><span> and </span><em><code>transform</code></em></p><ul><li><p><em><span>fit</span></em><span>: the vectorizer learns from the input text data (</span><code>twenty_train.data</code><span>) by scanning all the documents to identify every unique word, performing text preprocessing and tokenizing in the process. This builds an internal dictionary of features.</span></p></li><li><p><em><span>transform</span></em><span>: The vectorizer then uses the internal dictionary of features to convert the text documents into a numerical matrix. Each document is converted into a </span><em><span>feature vector</span></em><span> (a row) where the values are the counts of each word in the dictionary. The resulting feature vector matrix, </span><code>X_train_counts</code><span>, is the numerical representation of the training data.</span></p></li></ul></li></ul><h5 id='explore-the-feature-vector-matrix'><span>Explore the Feature Vector Matrix</span></h5><p><span>The feature vectors are now stored in </span><code>X_train_counts</code><span> which is a scipy sparse matrix. Lets take a look at it.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_counts</span>.<span class="cm-property">shape</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><blockquote><p><em><span>response:</span></em><span></span><br/><span>(2257, 35788)</span></p></blockquote><p><a href='https://scikit-learn.org/1.7/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html#sklearn.feature_extraction.text.CountVectorizer'><code>CountVectorizer</code></a><span> supports counts of words (or </span><em><span>N-grams</span></em><sup class='md-footnote'><a href='#dfref-footnote-5' name='ref-footnote-5'>5</a></sup><span> of words or consecutive characters). Once fitted, our vectorizer object will have built a dictionary of feature indices:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">count_vect</span>.<span class="cm-property">vocabulary_</span>.<span class="cm-property">get</span>(<span class="cm-string">'algorithm'</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><blockquote><p><em><span>response</span></em><span></span><br/><span>4690</span></p></blockquote><ul><li><p><code>count_vect</code><span> is the </span><code>CountVectorizer</code><span> object for our </span><code>train_twenty</code><span> project.</span></p></li><li><p><span>.</span><code>vocabulary_</code><span> is a Python attribute which is a dictionary containing a mapping of terms to feature indices. (Words are the keys and the values are indices into the feature matrix, </span><code>X_train_counts</code><span>)</span></p></li><li><p><code>.get(&#39;algorithm&#39;)</code><span> gets a count of the word &quot;algorithm&quot; in the </span></p></li></ul><h4 id='transform-occurance-counts-to-frequencies'><span>Transform Occurance Counts to Frequencies</span></h4><p><span>The count obtained above, was the number of occurances of the word &quot;algorithm&quot; across the entire corpus. Occurrence count is a good start but there is an issue: longer documents will have higher average count values than shorter documents, even though they might be about the same topics.</span></p><p><span>We can avoid this potential discrepancy by dividing the number of occurrences of each unique word in a document by the total number of words in the document: these will be new features called </span><code>tf</code><span> for </span><em><span>Term Frequencies</span></em><span>.</span></p><h5 id='calculating-term-frequency'><span>Calculating Term Frequency</span></h5><p><span>The scipy sparse matrix of </span><em><span>term frequencies</span></em><span> can be computed using </span><a href='https://scikit-learn.org/1.7/modules/generated/sklearn.feature_extraction.text.TfidfTransformer.html#sklearn.feature_extraction.text.TfidfTransformer'><code>TfidfTransformer</code></a><span>. (This code is an example, we won&#39;t use </span><code>X_train-tf</code><span>  after this.)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">feature_extraction</span>.<span class="cm-property">text</span> <span class="cm-keyword">import</span> <span class="cm-variable">TfidfTransformer</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tf_transformer</span> <span class="cm-operator">=</span> <span class="cm-variable">TfidfTransformer</span>(<span class="cm-variable">use_idf</span><span class="cm-operator">=</span><span class="cm-keyword">False</span>).<span class="cm-property">fit</span>(<span class="cm-variable">X_train_counts</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_tf</span> <span class="cm-operator">=</span> <span class="cm-variable">tf_transformer</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_train_counts</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_tf</span>.<span class="cm-property">shape</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 111px;"></div><div class="CodeMirror-gutters" style="display: none; height: 111px;"></div></div></div></pre><blockquote><p><em><span>resposnse:</span></em><span></span><br/><span>(2257, 35788)</span></p></blockquote><p><span>In the above example-code, we first used the </span><code>fit(..)</code><span> method to fit our estimator</span><sup class='md-footnote'><a href='#dfref-footnote-6' name='ref-footnote-6'>6</a></sup><span> to the data and secondly the </span><code>transform(..)</code><span> method to transform our count-matrix to a </span><code>tf</code><span> representation. </span></p><h5 id='calculating-term-frequency-and-inverse-term-frequency'><span>Calculating Term Frequency and Inverse Term Frequency</span></h5><p><span>Another refinement on top of </span><code>tf</code><span> is to give a lower weight to words that occur across many documents in the corpus and are therefore are less informative than those that occur only in a smaller portion of the corpus.</span></p><p><span>This weight reduction is called </span><a href='https://en.wikipedia.org/wiki/Tf-idf'><span>tf–idf</span></a><span> for “</span><em><span>Term Frequency</span></em><span> times </span><em><span>Inverse Document Frequency</span></em><span>”. The calculation of </span><code>tf</code><span> and </span><code>idf</code><span> can be combined. This is done through using the </span><code>fit_transform(..)</code><span> method as shown below:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tfidf_transformer</span> <span class="cm-operator">=</span> <span class="cm-variable">TfidfTransformer</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_tfidf</span> <span class="cm-operator">=</span> <span class="cm-variable">tfidf_transformer</span>.<span class="cm-property">fit_transform</span>(<span class="cm-variable">X_train_counts</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_tfidf</span>.<span class="cm-property">shape</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 83px;"></div><div class="CodeMirror-gutters" style="display: none; height: 83px;"></div></div></div></pre><blockquote><p><em><span>respoonse:</span></em><span></span><br/><span>(2257, 35788)</span></p></blockquote><p><code>X_train_tfidf</code><span> is the scipy sparce matrix containg the new feature vectors.</span></p><h3 id='training-a-classifier'><span>Training a classifier</span></h3><p><span>Now that we have our features in </span><code>X_train_tfidf</code><span>, we can train a classifier to try to predict the category of a post. Let&#39;s start with a </span><a href='https://scikit-learn.org/1.7/modules/naive_bayes.html#naive-bayes'><span>naïve Bayes</span></a><span> classifier, which provides a nice baseline for this task. </span><code>scikit-learn</code><span> includes several variants of this classifier, and the one most suitable for word counts is the </span><em><span>multinomial</span></em><sup class='md-footnote'><a href='#dfref-footnote-7' name='ref-footnote-7'>7</a></sup><span> variant:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">naive_bayes</span> <span class="cm-keyword">import</span> <span class="cm-variable">MultinomialNB</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clf</span> <span class="cm-operator">=</span> <span class="cm-variable">MultinomialNB</span>().<span class="cm-property">fit</span>(<span class="cm-variable">X_train_tfidf</span>, <span class="cm-variable">twenty_train</span>.<span class="cm-property">target</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 56px;"></div><div class="CodeMirror-gutters" style="display: none; height: 56px;"></div></div></div></pre><h3 id='making-predictions'><span>Making Predictions</span></h3><p><span>To try to predict the outcome on a new document we need to extract the features using almost the same feature extracting chain as before. The difference is that we call </span><code>transform</code><span> instead of </span><code>fit_transform</code><span> on the transformers, since they have already been fit to the training set:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">docs_new</span> <span class="cm-operator">=</span> [<span class="cm-string">'God is love'</span>, <span class="cm-string">'OpenGL on the GPU is fast'</span>]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_new_counts</span> <span class="cm-operator">=</span> <span class="cm-variable">count_vect</span>.<span class="cm-property">transform</span>(<span class="cm-variable">docs_new</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_new_tfidf</span> <span class="cm-operator">=</span> <span class="cm-variable">tfidf_transformer</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_new_counts</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">predicted</span> <span class="cm-operator">=</span> <span class="cm-variable">clf</span>.<span class="cm-property">predict</span>(<span class="cm-variable">X_new_tfidf</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">doc</span>, <span class="cm-variable">category</span> <span class="cm-keyword">in</span> <span class="cm-builtin">zip</span>(<span class="cm-variable">docs_new</span>, <span class="cm-variable">predicted</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin">print</span>(<span class="cm-string">'%r =&gt; %s'</span> <span class="cm-operator">%</span> (<span class="cm-variable">doc</span>, <span class="cm-variable">twenty_train</span>.<span class="cm-property">target_names</span>[<span class="cm-variable">category</span>]))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 222px;"></div><div class="CodeMirror-gutters" style="display: none; height: 222px;"></div></div></div></pre><blockquote><p><em><span>response:</span></em><span></span><br/><span>&#39;God is love&#39; =&gt; soc.religion.christian</span>
<span>&#39;OpenGL on the GPU is fast&#39; =&gt; comp.graphics</span></p></blockquote><p><strong><span>Explanation:</span></strong></p><ul><li><p><code>docs_new = [&#39;God is love&#39;, &#39;OpenGL on the GPU is fast&#39;]</code>
<span>Creates a list of new text documents that the classifier will attempt to categorize.</span></p></li><li><p><code>X_new_counts = count_vect.transform(docs_new)</code>
<span>Tokenizes the new documents and converts them into a feature matrix of word counts. It uses the vocabulary that the </span><code>count_vect</code><span> object learned from the training data.</span></p></li><li><p><code>X_new_tfidf = tfidf_transformer.transform(X_new_counts)</code></p><p><span>Converts the new count matrix into a normalized </span><em><span>Term Frequency</span></em><span> times </span><em><span>Inverse Document Frequency</span></em><span> representation.</span></p></li><li><p><code>predicted = clf.predict(X_new_tfidf)</code></p><p><strong><span>The prdiction happens here!</span></strong><span> The previously trained classifier </span><em><span>predicts</span></em><span> the category (topic) for each of the new documents.</span></p></li><li><p><code>for doc, category in zip(docs_new, predicted):</code></p><p><span>Starts a loop to iterate through the original new documents and their corresponding predicted category indices.</span></p></li><li><p><code>print(&#39;%r =&gt; %s&#39; % (doc, twenty_train.target_names[category]))</code></p><p><strong><span>Prints the result</span></strong><span> by showing the original document string (</span><code>doc</code><span>) followed by the category name, which is retrieved from the list of target names using the predicted numerical index (</span><code>category</code><span>).</span></p></li></ul><h2 id='building-a-pipeline'><span>Building a Pipeline</span></h2><p><span>In order to make the vectorizer =&gt; transformer =&gt; classifier easier to work with, </span><code>scikit-learn</code><span> provides a </span><a href='https://scikit-learn.org/1.7/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline'><code>Pipeline</code></a><span> class that behaves like a compound classifier:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">pipeline</span> <span class="cm-keyword">import</span> <span class="cm-variable">Pipeline</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">text_clf</span> <span class="cm-operator">=</span> <span class="cm-variable">Pipeline</span>([</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; (<span class="cm-string">'vect'</span>, <span class="cm-variable">CountVectorizer</span>()),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; (<span class="cm-string">'tfidf'</span>, <span class="cm-variable">TfidfTransformer</span>()),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; (<span class="cm-string">'clf'</span>, <span class="cm-variable">MultinomialNB</span>()),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ])</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 167px;"></div><div class="CodeMirror-gutters" style="display: none; height: 167px;"></div></div></div></pre><p><span>The names </span><code>vect</code><span>, </span><code>tfidf</code><span> and </span><code>clf</code><span> (classifier) are arbitrary. We will use them to perform grid search for suitable hyperparameters</span><sup class='md-footnote'><a href='#dfref-footnote-8' name='ref-footnote-8'>8</a></sup><span> below. We can now train the model with a single command:</span></p><p><strong><span>Note:</span></strong><span> In scikit-learn 1.7, when you display pipeline objects in Jupyter notebooks, you&#39;ll see enhanced HTML representations with comprehensive parameter information and a copy button for easy configuration.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">text_clf</span>.<span class="cm-property">fit</span>(<span class="cm-variable">twenty_train</span>.<span class="cm-property">data</span>, <span class="cm-variable">twenty_train</span>.<span class="cm-property">target</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><blockquote><p><em><span>response:</span></em><span></span><br/><span>Pipeline(steps=[(&#39;vect&#39;, CountVectorizer()), (&#39;tfidf&#39;, TfidfTransformer()),</span>
<span>             (&#39;clf&#39;, MultinomialNB())])</span></p></blockquote><p><strong><span>Estimators and hyperparameters used in the pipeline:</span></strong></p><p><span>Each of the estimators passed to the </span><code>text_clf</code><span> pipeline </span><code>fit</code><span> method contians a hyper parameter attribute that has a default value but can also be set to a new value. In our example we are using default values.</span></p><ul><li><p><span>CountVectorizer (</span><code>vect</code><span>). </span>
<em><span>ngram_range</span></em><span> is a tuple (start, end) that specifies the minimum and maximum lengths of contiguous word sequences (N-grams) to be extracted as features (tokens). The default is (1, 1).</span></p></li><li><p><span>TfidfTransformer (</span><code>tfidf</code><span>). </span><br/><em><span>use_idf</span></em><span> is set this to True or False determining whether the Inverse Document Frequency calculation is used. The default  is True.</span></p></li><li><p><span>MultinomialNB (</span><code>clf</code><span>)</span><br/><span>A key hyperparameter is </span><em><span>alpha</span></em><span> (known as the smoothing parameter). This small value is added to all counts to prevent zero probabilities. The default vlaue is 1.0.</span></p></li></ul><h2 id='testing-classification-accuracy'><span>Testing Classification Accuracy</span></h2><p><span>Evaluating the predictive accuracy of the model is equally easy. The news post text files that </span><code>fetch_20newsgroups</code><span> pulls data sets from are organized in </span><em><span>training</span></em><span> and </span><em><span>test</span></em><span> directories. To eveluate the performance of the classifier we will use the test posts.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">twenty_test</span> <span class="cm-operator">=</span> <span class="cm-variable">fetch_20newsgroups</span>(<span class="cm-variable">subset</span><span class="cm-operator">=</span><span class="cm-string">'test'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">categories</span><span class="cm-operator">=</span><span class="cm-variable">categories</span>, <span class="cm-variable">shuffle</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>, <span class="cm-variable">random_state</span><span class="cm-operator">=</span><span class="cm-number">42</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">docs_test</span> <span class="cm-operator">=</span> <span class="cm-variable">twenty_test</span>.<span class="cm-property">data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">predicted</span> <span class="cm-operator">=</span> <span class="cm-variable">text_clf</span>.<span class="cm-property">predict</span>(<span class="cm-variable">docs_test</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">np</span>.<span class="cm-property">mean</span>(<span class="cm-variable">predicted</span> <span class="cm-operator">==</span> <span class="cm-variable">twenty_test</span>.<span class="cm-property">target</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 167px;"></div><div class="CodeMirror-gutters" style="display: none; height: 167px;"></div></div></div></pre><blockquote><p><em><span>response:</span></em><span></span><br/><span>np.float64(0.9101198402130493)</span></p></blockquote><p><span>We achieved 83.5% accuracy. </span></p><h3 id='train-and-test-a-support-vector-machine'><span>Train and Test a Support Vector Machine</span></h3><p><span>Let&#39;s see if we can do better with a linear </span><a href='https://scikit-learn.org/1.7/modules/svm.html#svm'><span>support vector machine (SVM)</span></a><span>, which is widely regarded as one of the best text classification algorithms (although it&#39;s also a bit slower than naïve Bayes). We can change the learner by simply plugging a different classifier object into our pipeline:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">linear_model</span> <span class="cm-keyword">import</span> <span class="cm-variable">SGDClassifier</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">text_clf</span> <span class="cm-operator">=</span> <span class="cm-variable">Pipeline</span>([</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-string">'vect'</span>, <span class="cm-variable">CountVectorizer</span>()),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-string">'tfidf'</span>, <span class="cm-variable">TfidfTransformer</span>()),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-string">'clf'</span>, <span class="cm-variable">SGDClassifier</span>(<span class="cm-variable">loss</span><span class="cm-operator">=</span><span class="cm-string">'hinge'</span>, <span class="cm-variable">penalty</span><span class="cm-operator">=</span><span class="cm-string">'l2'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">alpha</span><span class="cm-operator">=</span><span class="cm-number">1e-3</span>, <span class="cm-variable">random_state</span><span class="cm-operator">=</span><span class="cm-number">42</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">max_iter</span><span class="cm-operator">=</span><span class="cm-number">5</span>, <span class="cm-variable">tol</span><span class="cm-operator">=</span><span class="cm-keyword">None</span>)),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">text_clf</span>.<span class="cm-property">fit</span>(<span class="cm-variable">twenty_train</span>.<span class="cm-property">data</span>, <span class="cm-variable">twenty_train</span>.<span class="cm-property">target</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 278px;"></div><div class="CodeMirror-gutters" style="display: none; height: 278px;"></div></div></div></pre><blockquote><p><em><span>Response:</span></em><span></span><br/><span>Pipeline(...)</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">predicted</span> <span class="cm-operator">=</span> <span class="cm-variable">text_clf</span>.<span class="cm-property">predict</span>(<span class="cm-variable">docs_test</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">np</span>.<span class="cm-property">mean</span>(<span class="cm-variable">predicted</span> <span class="cm-operator">==</span> <span class="cm-variable">twenty_test</span>.<span class="cm-property">target</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 56px;"></div><div class="CodeMirror-gutters" style="display: none; height: 56px;"></div></div></div></pre><blockquote><p><em><span>Response:</span></em><span></span><br/><span>np.float64(0.9101198402130493)</span></p></blockquote><p><span>We achieved 91.3% accuracy using the SVM.</span></p><h4 id='classification-report'><span>Classification Report</span></h4><p><span> </span><code>scikit-learn</code><span> provides further utilities for more detailed performance analysis of the results:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span> <span class="cm-keyword">import</span> <span class="cm-variable">metrics</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">metrics</span>.<span class="cm-property">classification_report</span>(<span class="cm-variable">twenty_test</span>.<span class="cm-property">target</span>, <span class="cm-variable">predicted</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">target_names</span><span class="cm-operator">=</span><span class="cm-variable">twenty_test</span>.<span class="cm-property">target_names</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 83px;"></div><div class="CodeMirror-gutters" style="display: none; height: 83px;"></div></div></div></pre><blockquote><p><em><span>Response:</span></em><span></span><br/><span>                                 precision    recall  f1-score   support</span>
<span>               alt.atheism       0.95      0.80      0.87       319</span>
<span>         comp.graphics       0.87      0.98      0.92       389</span>
<span>                      sci.med       0.94      0.89      0.91       396</span>
<span>soc.religion.christian      0.90      0.95      0.93       398</span></p><p><span>                     accuracy                                  0.91     1502</span>
<span>​                   macro avg      0.91      0.91      0.91     1502</span>
<span>​             weighted avg       0.91      0.91      0.91      1502</span></p></blockquote><p><span>The columns are showing the following:</span></p><ul><li><p><strong><span>Precision:</span></strong><span> the ratio </span><code>tp / (tp + fp)</code><span> where </span><code>tp</code><span> is the number of </span><em><span>true positives</span></em><span> and </span><code>fp</code><span> the number of </span><em><span>false positives</span></em><span>. The precision is intuitively the ability of the classifier not to label a negative sample as positive.</span></p></li><li><p><strong><span>Recall:</span></strong><span> the ratio </span><code>tp / (tp + fn)</code><span> where </span><code>tp</code><span> is the number of true positives and </span><code>fn</code><span> the number of false negatives. The recall is intuitively the ability of the classifier to find all the positive samples.</span></p></li><li><p><strong><span>F1-score:</span></strong><span> A balance between precision and recall (the harmonic mean). </span></p></li><li><p><strong><span>Support:</span></strong><span> the number of occurrences of each class in </span><code>y_true</code><span>.  (The number of actual samples for each class in the test set).</span></p></li></ul><h4 id='confusion-matrix'><span>Confusion Matrix</span></h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">metrics</span>.<span class="cm-property">confusion_matrix</span>(<span class="cm-variable">twenty_test</span>.<span class="cm-property">target</span>, <span class="cm-variable">predicted</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><blockquote><p><em><span>Response:</span></em><span></span><br/><span>array([</span>
<span>[256,  11,  16,  36],</span>
<span>[  4, 380,   3,   2],</span>
<span>[  5,  35, 353,   3],</span>
<span>[  5,  11,   4, 378]</span>
<span>])</span></p></blockquote><p><span>The  </span><em><span>confusion matrix</span></em><sup class='md-footnote'><a href='#dfref-footnote-9' name='ref-footnote-9'>9</a></sup><span> is arranged as follows:</span></p><ul><li><p><strong><span>Rows</span></strong><span> represent the actual classes of the documents (the ground truth). </span></p><ul><li><p><strong><span>TP</span></strong><span> (True Positive) is the count of posts correctly classified as in a class.</span></p></li><li><p><strong><span>FN</span></strong><span> (False Negative) is the count of posts incorrectly classified as outside a class.</span></p></li></ul></li><li><p><strong><span>Columns</span></strong><span> represent the predicted classes made by the classifier.</span></p><ul><li><p><strong><span>FP</span></strong><span> (False Positive) is the count of posts incorrectly classified as in a class.</span></p></li></ul></li></ul><p><span>The diagonal represents correct classifications.</span></p><figure class='table-figure'><table><thead><tr><th>&nbsp;</th><th><strong><span>Predicted Atheism</span></strong></th><th><strong><span>Predicted Graphics</span></strong></th><th><strong><span>Predicted Medical</span></strong></th><th><strong><span>Predicted Christianity</span></strong></th></tr></thead><tbody><tr><td><strong><span>Actual Atheism</span></strong></td><td><strong><span>256</span></strong><span> (TP)</span></td><td><span>11 (FN)</span></td><td><span>16 (FN)</span></td><td><span>36 (FN)</span></td></tr><tr><td><strong><span>Actual Graphics</span></strong></td><td><span>4 (FN)</span></td><td><strong><span>380</span></strong><span> (TP)</span></td><td><span>3 (FN)</span></td><td><span>2 (FN)</span></td></tr><tr><td><strong><span>Actual Medical</span></strong></td><td><span>5 (FN)</span></td><td><span>35 (FN)</span></td><td><strong><span>353</span></strong><span> (TP)</span></td><td><span>3 (FN)</span></td></tr><tr><td><strong><span>Actual Christianity</span></strong></td><td><span>5 (FN)</span></td><td><span>11 (FN)</span></td><td><span>4 (FN)</span></td><td><strong><span>378</span></strong><span> (TP)</span></td></tr><tr><td>&nbsp;</td><td><span>14  FP</span></td><td><span>57  FP</span></td><td><span>23  FP</span></td><td><span>41  FP</span></td></tr></tbody></table></figure><p><span>As expected, this shows that posts from the newsgroups on atheism and Christianity are more often confused for one another than with computer graphics.</span></p><h2 id='parameter-tuning-using-grid-search'><span>Parameter Tuning Using Grid Search</span></h2><p><span>We’ve already encountered some parameters such as </span><code>use_idf</code><span> in the </span><code>TfidfTransformer</code><span>. Classifiers tend to have many parameters as well; e.g., </span><code>MultinomialNB</code><span> includes a smoothing parameter </span><code>alpha</code><span> and </span><code>SGDClassifier</code><span> has a penalty parameter </span><code>alpha</code><span> and configurable loss and penalty terms in the objective function (see the module documentation, or use the Python </span><code>help</code><span> function to get a description of these).</span></p><p><span>Instead of tweaking the parameters of the various components of the chain, it is possible to run an exhaustive search of the best parameters on a grid of possible values. We try out all classifiers on either words or </span><em><span>bigrams</span></em><sup class='md-footnote'><a href='#dfref-footnote-10' name='ref-footnote-10'>10</a></sup><span>, with or without </span><em><span>idf</span></em><span>, and with a penalty parameter of either 0.01 or 0.001 for the linear SVM:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">model_selection</span> <span class="cm-keyword">import</span> <span class="cm-variable">GridSearchCV</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">parameters</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-string">'vect__ngram_range'</span>: [(<span class="cm-number">1</span>, <span class="cm-number">1</span>), (<span class="cm-number">1</span>, <span class="cm-number">2</span>)],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-string">'tfidf__use_idf'</span>: (<span class="cm-keyword">True</span>, <span class="cm-keyword">False</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-string">'clf__alpha'</span>: (<span class="cm-number">1e-2</span>, <span class="cm-number">1e-3</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 167px;"></div><div class="CodeMirror-gutters" style="display: none; height: 167px;"></div></div></div></pre><p><span>Obviously, such an exhaustive search can be expensive. If we have multiple CPU cores at our disposal, we can tell the grid searcher to try these eight parameter combinations in parallel with the </span><code>n_jobs</code><span> parameter. If we give this parameter a value of </span><code>-1</code><span>, grid search will detect how many cores are installed and use them all:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gs_clf</span> <span class="cm-operator">=</span> <span class="cm-variable">GridSearchCV</span>(<span class="cm-variable">text_clf</span>, <span class="cm-variable">parameters</span>, <span class="cm-variable">cv</span><span class="cm-operator">=</span><span class="cm-number">5</span>, <span class="cm-variable">n_jobs</span><span class="cm-operator">=-</span><span class="cm-number">1</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><p><span>Note that </span><code>txt_clf</code><span> is still the SVG classifier, which is the classifier whose parameters we are tuning with grid search. The grid search instance behaves like a normal </span><code>scikit-learn</code><span> model. </span></p><p><span>Let’s perform the search on a smaller subset of the training data to speed up the computation:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gs_clf</span> <span class="cm-operator">=</span> <span class="cm-variable">gs_clf</span>.<span class="cm-property">fit</span>(<span class="cm-variable">twenty_train</span>.<span class="cm-property">data</span>[:<span class="cm-number">400</span>], <span class="cm-variable">twenty_train</span>.<span class="cm-property">target</span>[:<span class="cm-number">400</span>])</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><p><span>Calling </span><code>fit</code><span> on a </span><code>GridSearchCV</code><span> object returns a classifier that we can use to </span><code>predict</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">twenty_train</span>.<span class="cm-property">target_names</span>[<span class="cm-variable">gs_clf</span>.<span class="cm-property">predict</span>([<span class="cm-string">'God is love'</span>])[<span class="cm-number">0</span>]]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><blockquote><p><em><span>Response:</span></em><span></span><br/><span>&#39;soc.religion.christian&#39;</span></p></blockquote><p><span>The object’s </span><code>best_score_</code><span> and </span><code>best_params_</code><span> attributes store the best mean score and the parameters setting corresponding to that score:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gs_clf</span>.<span class="cm-property">best_score_</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><blockquote><p><em><span>Response:</span></em><span></span><br/><span>np.float64(0.9175000000000001)</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">param_name</span> <span class="cm-keyword">in</span> <span class="cm-builtin">sorted</span>(<span class="cm-variable">parameters</span>.<span class="cm-property">keys</span>()):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin">print</span>(<span class="cm-string">"%s: %r"</span> <span class="cm-operator">%</span> (<span class="cm-variable">param_name</span>, <span class="cm-variable">gs_clf</span>.<span class="cm-property">best_params_</span>[<span class="cm-variable">param_name</span>]))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 56px;"></div><div class="CodeMirror-gutters" style="display: none; height: 56px;"></div></div></div></pre><blockquote><p><em><span>Response:</span></em><span></span><br/><span>clf_ </span><em><span>alpha: 0.001</span>
<span>tfidf</span></em><span> </span><em><span>use_idf: True</span>
<span>vect</span></em><span> _ngram_range: (1, 1)</span></p></blockquote><p><span>You can get a more detailed summary of the search from </span><code>gs_clf.cv_results_</code><span>.</span></p><p><span>The </span><code>cv_results_</code><span> parameter can be easily imported into pandas as a </span><code>DataFrame</code><span> for further inspection.</span></p><h2 id='exercises'><span>Exercises</span></h2><h3 id='setup-for-all-the-exercises'><span>Setup for All the Exercises</span></h3><p><span>The source code for these exercises is </span><a href='https://github.com/scikit-learn/scikit-learn/tree/1.4.X/doc/tutorial/text_analytics'><span>on GitHub</span></a><span>.</span></p><p><span>The tutorial folder on GitHub should contain the following sub-folders:</span></p><ul><li><p><code>*.rst files</code><span> - the source of the tutorial document written with sphinx.</span></p></li><li><p><code>data</code><span> - folder to put the datasets used during the tutorial.</span></p></li><li><p><code>skeletons</code><span> - sample incomplete scripts for the exercises.</span></p></li><li><p><code>solutions</code><span> - solutions of the exercises.</span></p></li></ul><p><span>Copy the skeletons folder into a new folder somewhere on your hard-drive named </span><code>sklearn_TextAnalyaticsTutorial</code><span>, where you can edit your own files for the exercises while keeping the original skeletons intact:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cp</span> <span class="cm-operator">-</span><span class="cm-variable">r</span> <span class="cm-variable">skeletons</span> <span class="cm-variable">your_path</span><span class="cm-operator">/</span><span class="cm-variable">sklearn_TextAnalyaticsTutorial</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><p><span>Machine learning algorithms need data. Go to each </span><code>sklearn_TextAnalyaticsTutorial</code><span> sub-folder and run the </span><code>fetch_data.py</code><span> script from there (after having read them first).</span></p><p><span>Note: </span><code>fetch_data.py</code><span> imports the </span><code>lxml</code><span> module for XML processing.  You will need to install that package with the command: </span><code>pip install lxml</code><span>.</span></p><p><span>Now run </span><code>fetch_data.py</code><span> in the languages and movie_reviews folders.</span></p><p><span>Then  run the work-in-progress script from </span><code>sklearn_TextAnalyaticsTutorial</code><span> with:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">python</span> <span class="cm-variable">exercise_XX_script</span>.<span class="cm-property">py</span> <span class="cm-variable">arg1</span> <span class="cm-comment"># arg1 is the training data folder</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 28px;"></div></div></div></pre><p><span>Or run the script in an IDE where you can edit and debug more easily.</span></p><p><span>Refine the implementation and iterate until the exercise is solved.</span></p><p><strong><span>For each exercise, the skeleton file provides all the necessary import statements, boilerplate code to load the data and sample code to evaluate the predictive accuracy of the model.</span></strong></p><h3 id='exercise-1-language-identification'><span>Exercise 1: Language identification</span></h3><ul><li><p><span>Write a text classification pipeline using a custom preprocessor and </span><code>TfidfVectorizer</code><span> set up to use </span><em><span>character based</span></em><span> </span><em><span>n-grams</span></em><span>, using data from Wikipedia articles as the training set.</span></p></li><li><p><span>Evaluate the performance on some held out test set.</span></p></li></ul><h4 id='hints'><span>Hints</span></h4><ul><li><p><span>Setting up a vectorizer for a character instead of word sequence.</span><br/><span>This code specifies </span><em><span>n-grams</span></em><span> of 1, 2, or 3 character sequences.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.88888931274414px; left: 7.326416015625px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">vectorizer</span> <span class="cm-operator">=</span> <span class="cm-variable">TfidfVectorizer</span>(</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">analyzer</span><span class="cm-operator">=</span><span class="cm-string">'char'</span>, &nbsp; &nbsp; &nbsp;<span class="cm-comment"># Use individual characters as features</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ngram_range</span><span class="cm-operator">=</span>(<span class="cm-number">1</span>, <span class="cm-number">3</span>) &nbsp; &nbsp;<span class="cm-comment"># Extract unigrams (1), bigrams (2), and trigrams (3)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 111px;"></div><div class="CodeMirror-gutters" style="display: none; height: 111px;"></div></div></div></pre><p>&nbsp;</p></li></ul><h3 id='exercise-2-sentiment-analysis-on-movie-reviews'><span>Exercise 2: Sentiment Analysis on movie reviews</span></h3><ul><li><p><span>Write a text classification pipeline to classify movie reviews as either positive or negative.</span></p></li><li><p><span>Find a good set of parameters using grid search.</span></p></li><li><p><span>Evaluate the performance on a held out test set.</span></p></li></ul><h3 id='exercise-3-cli-text-classification-utility'><span>Exercise 3: CLI text classification utility</span></h3><p><span>Using the results of the previous exercises and the </span><code>cPickle</code><span> module of the standard library, write a command line utility that detects the language of some text provided on </span><code>stdin</code><span> and estimate the polarity (positive or negative) if the text is written in English.</span></p><p><span>Bonus point if the utility is able to give a confidence level for its predictions.</span></p><h3 id='where-to-from-here'><span>Where to from here</span></h3><p><span>Here are a few suggestions to help further your scikit-learn intuition upon the completion of this tutorial:</span></p><ul><li><p><span>Try playing around with the </span><code>analyzer</code><span> and </span><code>token normalisation</code><span> under </span><a href='https://scikit-learn.org/1.7/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html#sklearn.feature_extraction.text.CountVectorizer'><code>CountVectorizer</code></a><span>.</span></p></li><li><p><span>If you don&#39;t have labels, try using </span><a href='https://scikit-learn.org/1.7/auto_examples/text/plot_document_clustering.html#sphx-glr-auto-examples-text-plot-document-clustering-py'><span>Clustering</span></a><span> on your problem.</span></p></li><li><p><span>If you have multiple labels per document, e.g. categories, have a look at the </span><a href='https://scikit-learn.org/1.7/modules/multiclass.html#multiclass'><span>Multiclass and multilabel section</span></a><span>.</span></p></li><li><p><span>Try using </span><a href='https://scikit-learn.org/1.7/modules/decomposition.html#lsa'><span>Truncated SVD</span></a><span> for </span><a href='https://en.wikipedia.org/wiki/Latent_semantic_analysis'><span>latent semantic analysis</span></a><span>.</span></p></li><li><p><span>Have a look at using </span><a href='https://scikit-learn.org/1.7/auto_examples/applications/plot_out_of_core_classification.html#sphx-glr-auto-examples-applications-plot-out-of-core-classification-py'><span>Out-of-core Classification</span></a><span> to learn from data that would not fit into the computer main memory.</span></p></li><li><p><span>Have a look at the </span><a href='https://scikit-learn.org/1.7/modules/feature_extraction.html#hashing-vectorizer'><span>Hashing Vectorizer</span></a><span> as a memory efficient alternative to </span><a href='https://scikit-learn.org/1.7/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html#sklearn.feature_extraction.text.CountVectorizer'><code>CountVectorizer</code></a><span>.</span></p></li></ul><h2 id='whats-new-in-scikit-learn-17-for-text-processing'><span>What&#39;s New in scikit-learn 1.7 for Text Processing</span></h2><p><span>scikit-learn 1.7 introduces several enhancements that improve the text processing workflow:</span></p><ul><li><p><strong><span>Enhanced Estimator Visualization</span></strong><span>: In Jupyter notebooks, estimators now display comprehensive parameter information with non-default parameters highlighted, and include a copy button for easy configuration of nested pipelines and hyperparameter searches.</span></p></li><li><p><strong><span>Sparse Array Compatibility</span></strong><span>: All text processing estimators now support both traditional </span><code>scipy.sparse</code><span> matrices and the new sparse arrays (</span><code>sparray</code><span>), ensuring future compatibility as SciPy transitions to sparse arrays.</span></p></li><li><p><strong><span>Extended Array API Support</span></strong><span>: Several metrics used in text classification now support Array API-compatible data structures from libraries like PyTorch or CuPy, with the </span><code>array-api-compat</code><span> module now natively integrated.</span></p></li><li><p><strong><span>Improved Pipeline Configuration</span></strong><span>: The enhanced HTML representation makes it easier to configure complex text processing pipelines with multiple transformers and classifiers.</span></p></li></ul><p>&nbsp;</p><hr /><p><span>This </span><a href='https://scikit-learn.org/1.4/tutorial/text_analytics/working_with_text_data.html'><span>original version</span></a><span> of this tutorial was written by scikit-learn developers under a </span><a href='https://opensource.org/license/BSD-3-clause'><span>BSD License</span></a><span>.  </span></p><p><span>The code examples and text were updated for scikit-learn version 1.7 by Brian Bird, 10/23/2025</span></p><p><span>Note: Claude Sonet 4 and Gemini Flash 2.5 were used to assist in drafting the revisions to this tutorial.</span></p><p>&nbsp;</p><p>&nbsp;</p><div class='footnotes-area'  ><hr/>
<div class='footnote-line'><span class='md-fn-count'>1</span> <em><span>Text preprossesing</span></em><span> is the initial set of steps to clean and standardize raw text data before analysis. This often includes converting all text to lowercase, removing punctuation, and handling special characters to ensure consistency. ↩</span> <a name='dfref-footnote-1' href='#ref-footnote-1' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>2</span> <em><span>Tokenizing</span></em><span> is the process of breaking down a text document into smaller units called </span><em><span>tokens</span></em><span>. Tokens are usually words, but can also be individual characters or parts of words.</span> <a name='dfref-footnote-2' href='#ref-footnote-2' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>3</span> <em><span>Stopwords</span></em><span> are common words (like &quot;the,&quot; &quot;a,&quot; &quot;is,&quot; &quot;and,&quot; &quot;of&quot;) that generally don&#39;t carry significant meaning for classification or analysis. Removing them helps reduce the size of the feature set and can improve model performance.</span> <a name='dfref-footnote-3' href='#ref-footnote-3' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>4</span> <span>A </span><em><span>feature vector</span></em><span> in the context of scikit-learn is a one-dimensional array of numerical values that represents a single data point (or sample) to be used by a machine learning algorithm.</span> <a name='dfref-footnote-4' href='#ref-footnote-4' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>5</span> <span>An </span><em><span>n-gram</span></em><span> is a contiguous sequence of N characters or words from a given sample of text.</span> <a name='dfref-footnote-5' href='#ref-footnote-5' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>6</span> <em><span>Estimators</span></em><span> are objects in scikit-learn that can learn parameters from data by implementing a </span><code>.fit()</code><span> method. These include: </span><em><span>Predictors</span></em><span> (Models): like </span><code>MultinomialNB</code><span> or </span><code>LinearRegression</code><span> and </span><em><span>Transformers</span></em><span> (Preprocessing Tools) like </span><code>CountVectorizer</code><span> or </span><code>StandardScaler</code><span> that learn rules to transform or process data.</span> <a name='dfref-footnote-6' href='#ref-footnote-6' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>7</span> <em><span>Multinomial</span></em><span> in this context, means the classifier is built to handle data with many features. The &quot;multi&quot; refers to the entire vocabulary of unique words, where every word is treated as a separate feature. The model works by learning the relative frequency of all the words for a specific topic.</span> <a name='dfref-footnote-7' href='#ref-footnote-7' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>8</span> <em><span>Hyperparameter</span></em><span> refers to a configuration setting that is external to the model and whose value can&#39;t be estimated from the data. Instead, a hyperparameter&#39;s value must be set by the developer.</span> <a name='dfref-footnote-8' href='#ref-footnote-8' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>9</span> <span>A </span><em><span>confusion matrix</span></em><span> is a table used to evaluate the performance of a classification model on a set of test data for which the true values are known. It visually summarizes the classifier&#39;s performance by comparing the predicted categories to the actual categories.</span> <a name='dfref-footnote-9' href='#ref-footnote-9' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>10</span> <span>A </span><em><span>bigram</span></em><span> is an </span><em><span>n-gram</span></em><span> sequence of two words or characters, for example: &quot;quick brown&quot; or &quot;qu&quot;.</span> <a name='dfref-footnote-10' href='#ref-footnote-10' title='back to document' class='reversefootnote' >↩</a></div></div></div></div>
</body>
</html>